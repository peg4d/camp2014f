// PEG4d JavaScript Grammar

// # Rule naming rule:
// 1. The rule creating a object is named in UpperCamelCase
//    ex) TheRule = { @OtherRule #TheTag }
// 2. The rule not creating any object but contains # or @ is named in lowerCamelCase
//    ex) theRule = '=' @OtherRule
//    ex) theRule = DIGIT+ #Number
// 3. Otherwise, it named in UPPER_CASE
//    ex) DIGIT = [1-9][0-9]* / '0'
//
// # Tag naming rule
// 1. Tags should be named in UpperCamelCase


File
	= Statement*

Chunk
	= Statement*

WS
  = [\t\v\f ]
//  / "\u00A0"
//  / "\uFEFF"
//  / Zs

// Space including line terminator
__
    = (WS / LINE_TERMINATOR_SEQUENCE / COMMENT)*

// Space without line terminator
_
    = (WS / MULTI_LINE_COMMENT_SINGLE_LINE)*

LINE_TERMINATOR
    = [\n\r]

LINE_TERMINATOR_SEQUENCE
    = '\n' / '\r\n' / '\r'

COMMENT
  = MULTI_LINE_COMMENT / SINGLE_LINE_COMMENT

MULTI_LINE_COMMENT
  = '/*' (!'*/' .)* '*/'

MULTI_LINE_COMMENT_SINGLE_LINE
  = '/*' (!('*/' / LINE_TERMINATOR) .)* '*/'

SINGLE_LINE_COMMENT
  = '//' (!LINE_TERMINATOR .)*

//Automatic Semicolon Insertion

EOS
  = __ ';'
  / _ SINGLE_LINE_COMMENT? LINE_TERMINATOR_SEQUENCE
  / _ &'}'
  / __ EOF

EOF
  = !.

//Operator
//==========

"++"  = '++' __
"--"  = '--' __
"&"   = '&' !'&' __
"*"   = '*' !'=' __
"+"   = '+' ![+=] __
"-"   = '-' !('-' / [=>]) __
"~"   = '~' __
"!"   = '!' !'=' __
"{"   = '{' __
"["   = '[' __
"]"   = ']' __
"("	  = '(' __
")"	  = ')' __
"."	  = '.' __
","	  = ',' __
":"	  = ':' ![>] __
"/"	  = '/' !'=' __
"%"	  = '%' ![=>] __
"<<"  = '<<' !'=' __
">>"  = '>>' !'=' __
"<="  = '<=' __
">="  = '>=' __
"<"	  = '<' ![=] __
">"	  = '>' ![=] __
"=="  = '==' ![=]__
"===" = '===' __
"!="  = '!=' ![=] __
"!==" = '!==' __
"^"	  = '^' ![=] __
"|"	  = '|' ![=] __
"&&"  = '&&' __
"||"  = '||' __
"?"	  = '?' __
"*="  = '*=' __
"/="  = '/=' __
"%="  = '%=' __
"+="  = '+=' __
"-="  = '-=' __
"<<=" = '<<=' __
">>=" = '>>=' __
"&="  = '&=' __
"^="  = '^=' __
"|="  = '|=' __
"="	  = '=' ![=] __
"break" = 'break' !W
"case" = 'case' !W
"catch" = 'catch' !W
"continue" = 'continue' !W
"debugger" = 'debugger' !W
"default" = 'default' !W
"delete" = 'delete' !W
"do" = 'do' !W
"else" = 'else' !W
"finally" = 'finally' !W
"for" = 'for' !W
"function" = 'function' !W
"if" = 'if' !W
"in" = 'in' !W
"instanceof" = 'instanceof' !W
"new" = 'new' !W
"return" = 'return' !W
"switch" = 'switch' !W
"this" = 'this' !W
"throw" = 'throw' !W
"try" = 'try' !W
"typeof" = 'typeof' !W
"var" = 'var' !W
"void" = 'void' !W
"while" = 'while' !W
"with" = 'with' !W
"class" = 'class' !W
"enum" = 'enum' !W
"export" = 'export' !W
"extends" = 'extends' !W
"import" = 'import' !W
"super" = 'super' !W
"implements" = 'implements' !W
"interface" = 'interface' !W
"let" = 'let' !W
"package" = 'package' !W
"private" = 'private' !W
"protected" = 'protected' !W
"public" = 'public' !W
"static" = 'static' !W
"yield" = 'yield' !W

KEYWORD
    = "break" / "case" / "catch" / "continue" / "debugger" / "default" / "delete" / "do"
    / "else" / "finally" / "for" / "function" / "if" / "in" / "instanceof" / "new"
    / "return" / "switch" / "this" / "throw" / "try" / "typeof" / "var" / "void"
    / "while" / "with" / "class" / "enum" / "export" / "extends" / "import" / "super"
    / "implements" / "interface" / "let" / "package" / "private" / "protected" / "public"
    / "static" / "yield"

//Expression
//==========

Expression
    = CommaExpression

CommaExpression
	= AssignmentExpression {@ "," @AssignmentExpression #CommaExpression }*

AssignmentExpression
	= { @UnaryExpression addAssignmentOperator @AssignmentExpression }
	/ ConditionalExpression

<<<<<<< HEAD
addAssignmentOperator
	= "="   #Assign
	/ "*="  #AssignMul
	/ "/="  #AssignDiv
	/ "%="  #AssignMod
	/ "+="  #AssignAdd
	/ "-="  #AssignSub
	/ "<<=" #AssignLeftShift
	/ ">>=" #AssignRightShift
	/ "&="  #AssignBitwiseAnd
	/ "^="  #AssignBitwiseXOr
	/ "|="  #AssignBitwiseOr
=======
ArrayLiteral
    [example:[]]
    [example:[,,,]]
    [example:[1,2,3]]
    [example:[1,2,3,]]
    [example:[,1,2,3,]]
    = { "[" (addElisionList __)? "]"
      / "[" addElementList __ "]"
      / "[" addElementList addArrayDelimitor "]" #ArrayExpression }
>>>>>>> efd4a1c5a945e678725e8c495c43283070d2ea63

ConstantExpression
	= ConditionalExpression

ConditionalExpression
	= LogicalORExpression {@ "?"  @Expression ":" @LogicalORExpression #Trinary }*

LogicalORExpression
	= LogicalANDExpression {@ "||" @LogicalANDExpression #Or }*

LogicalANDExpression
	= InclusiveORExpression {@ "&&" @InclusiveORExpression #And }*

InclusiveORExpression
	= ExclusiveORExpression {@ "|" @ExclusiveORExpression #BitwiseOr }*

ExclusiveORExpression
	= ANDExpression {@ "^" @ANDExpression #BitwiseXor }*

ANDExpression
	= EqualityExpression {@ "&" @EqualityExpression #BitwiseAnd }*

EqualityExpression
	= RelationalExpression {@ ( "==" #Equals / "!=" #NotEquals ) @RelationalExpression }*

RelationalExpression
	= ShiftExpression {@ ( "<=" #LessThanEquals / ">=" #GreaterThanEquals / "<" #LessThan / ">" #GreaterThan ) @ShiftExpression }*

ShiftExpression
	= AdditiveExpression {@ ( "<<" #LeftShift / ">>" #RightShift ) @AdditiveExpression }*

AdditiveExpression
	= MultiplicativeExpression {@ ( "+" #Add / "-" #Sub ) @MultiplicativeExpression }*

MultiplicativeExpression
	= CastExpression {@ ( "*" #Mul / "/" #Div / "%" #Mod ) @CastExpression }*

UnaryExpression
	= PostfixExpression
	/ { "++"    @UnaryExpression #PrefixInc }
	/ { "--"    @UnaryExpression #PrefixDec }
	/ { "&"    @CastExpression #Address }
	/ { "*"   @CastExpression #Star }
	/ { "+"   @CastExpression #Plus }
	/ { "-"  @CastExpression #Minus }
	/ { "~"  @CastExpression #Compl }
	/ { "!"   @CastExpression #Not }
	/ { "sizeof"  ( @UnaryExpression / "(" @Type ")" ) #SizeOf }

CastExpression
	= { "(" @Type ")" @CastExpression #Cast }
	/ UnaryExpression

PostfixExpression
	= ( PrimaryExpression / { "(" @Type ")" "{" @{ (addInitializerList)* ","? #Initializer } "}" } )
	{@ (addFunctionCall / addIndex / addField / addInc / addDec) }*

addFunctionCall
	= @{ "(" addArgumentExpressionList? ")" #List} #Apply

addArgumentExpressionList
	= (@AssignmentExpression ("," @AssignmentExpression)*)

addIndex
	= "[" @Expression "]" #Index

addField
	= "." @Name #Field

addPointerField
	= "->" @Name #PointerField

addInc
	= "++" #Inc

addDec
	= "--" #Dec

PrimaryExpression
	= Constant
	/ CString
	/ "(" Expression ")"
	/ Name

<<<<<<< HEAD
//Statement
//==========
Statement
    [example:var a = 0;]
    = 'var a = 0;'

//Literal
//==========
Literal
    = NullLiteral / BooleanLiteral / NumericLiteral / StringLiteral / RegularExpressionLiteral
=======
AdditiveExpression
	= MultiplicativeExpression {@ ( "+" #Add / "-" #Sub ) @MultiplicativeExpression }*

ShiftExpression
	= AdditiveExpression {@ ( "<<" #LeftShift / ">>" #RightShift ) @AdditiveExpression }*

RelationalExpression
	= ShiftExpression {@ addRelationalOperator @ShiftExpression }*

addRelationalOperator
    = "<=" #LessThanEquals
    / ">=" #GreaterThanEquals
    / "<" #LessThan
    / ">" #GreaterThan
    / "instanceof" #InstanceOf
    / "in" #In

EqualityExpression
	= RelationalExpression {@ addEqualityOperator @RelationalExpression }*

addEqualityOperator
    = "=="  #Equals
    / "!="  #NotEquals
    / "===" #StrictEquals
    / "!==" #StrictNotEqual
>>>>>>> efd4a1c5a945e678725e8c495c43283070d2ea63

NullLiteral
		[example: null]
		= { "null" #Null }

BooleanLiteral
		[example: true]
		= { ( "true" / "false" ) #Bool }

NumericLiteral
		= OctalIntegerLiteral / HexIntegerLiteral / DecimalLiteral / FloatingPointLiteral

DecimalLiteral
		[example: 123]
		[example: +123]
		[example: -123]
		= { SIGN? [1-9] DecimalDigit* #DecimalInteger }

<<<<<<< HEAD
OctaIntegerLiteral
		[example: 0]
		[example: 012]
		= { SIGN? '0' ( [1-7] OctaDigit* )? #OctaInteger }
=======
LogicalORExpression
	= LogicalANDExpression {@ "||" @LogicalANDExpression #Or }*

ConditionalExpression
	= LogicalORExpression {@ "?"  @Expression ":" @LogicalORExpression #Trinary }*
>>>>>>> efd4a1c5a945e678725e8c495c43283070d2ea63

HexIntegerLiteral
		[example: 0xa12]
		[example: -0Xa12]
		= { SIGN? '0' [xX] [1-9A-Fa-f] HexDigit* #HexInteger }

<<<<<<< HEAD
FloatingPointLiteral
		[example: 12.456]
		[example: -0.12]
		= { SIGN? ( '0' / [1-9] DecimalDigit* ) '.' [0-9]+ ( [eE] SIGN? [1-9] DecimalDigit* )? #FloatingPointNumber }
=======
addAssignmentOperator
	= "="   #Assign
	/ "*="  #AssignMul
	/ "/="  #AssignDiv
	/ "%="  #AssignMod
	/ "+="  #AssignAdd
	/ "-="  #AssignSub
	/ "<<=" #AssignLeftShift
	/ ">>=" #AssignRightShift
	/ "&="  #AssignBitwiseAnd
	/ "^="  #AssignBitwiseXOr
	/ "|="  #AssignBitwiseOr
>>>>>>> efd4a1c5a945e678725e8c495c43283070d2ea63

DecimalDigit
		= [0-9]

OctaDigit
		= [0-7]

<<<<<<< HEAD
HexDigit
		= [0-9a-fA-F]

SIGN
		= ( '+' / '-' )

SOURCE
		= .

StringLiteral
		= '"' { DoubleStringCharacter* #String } '"' / "'" { SingleStringCharacter* #String } "'"

DoubleStringCharacter
		= !( '"' / '\\' / LINE_TERMINATOR ) SOURCE / '\\' EscapeSequence / LineContinuation

SingleStringCharacter
		= !( "'" / '\\' / LINE_TERMINATOR ) SOURCE / '\\' EscapeSequence / LineContinuation

LineContinuation
		= '\\' LINE_TERMINATOR_SEQUENCE

EscapeSequence
		= '\\' / "'" / '"' / [bfnrtv] / OctaEscapeSequence / HexEscapeSequence / UnicodeEscapeSequuence

OctaEscapeSequence
		= OctaDigit OctaDigit OctaDigit

HexEscapeSequence
		= [xX] HexDigit HexDigit

UnicodeEscapeSequuence
		= [uU] HexDigit HexDigit HexDigit HexDigit

RegularExpressionLiteral
	= { '/' @RegularExpressionBody '/' @RegularExpressionFlags #RegularExp }

RegularExpressionBody
	= RegularExpressionFirstChar RegularExpressionChar*

RegularExpressionFirstChar
	= ![*\\/\x5b] RegularExpressionNonTerminator / RegularExpressionBackslashSequence / RegularExpressionClass

RegularExpressionChar
	= ![*\\/\x5b] RegularExpressionNonTerminator / RegularExpressionBackslashSequence / RegularExpressionClass

RegularExpressionBackslashSequence
	= '\\' RegularExpressionNonTerminator

RegularExpressionNonTerminator
	= !LINE_TERMINATOR SOURCE

RegularExpressionClass
	= '[' RegularExpressionClassChar* ']'
	
RegularExpressionClassChar
	= ![\x5d\\] RegularExpressionNonTerminator / RegularExpressionBackslashSequence

RegularExpressionFlags
	= W*
=======
//Statement
//==========
Block
	[example:{var a = 0;}]
	= { "{" (@Statement)* "}" #Block }

Declaration
	//[example:var a = 0, b, c = 1 + 3;]
	= { "var" @Name ("=" @Expression)? ("," @InitDecl)* EOS}

InitDecl
	= {"var" @Name ("=" @Expression)? #VarDecl }

Statement
    [example:var a = 0;]
		[example:break;]
		[example:if(1 + 1){var a = 0;}]
		//[example:switch(a){case 1: break; default: a = 1+3;}]
		[example:while(1){var a = 0;}]
		[example:do{var a = 0;}while(2 > 1)]
		//[example:for(var i = 0;i < 5; i ++){ i += 1;}]
    = 'var a = 0;'
		/ Block
		/ { "if" "(" @Expression ")" @Statement ("else" @Statement)? EOS #If }
		/ { "switch" "(" @Expression ")" "{" @CaseBlock (@DefaultBlock)? "}" EOS #Switch }
		/ { "while" "(" @Expression ")" @Statement EOS #While }
		/ { "do" @Statement "while" "(" @Expression ")" EOS #DoWhile }
		/ { "for" "(" (@Expression)? ";" (@Expression)? ";" (@Expression)? ")" @Statement EOS #For }
		/ { "for" "(" @Declaration? ";" (@Expression)? ";" (@Statement)? ";" EOS #For }
		/ { "continue" (@LabelledStatement)? EOS #Continue }
		/ { "return" (@Expression)? EOS #Return}
		/ { "const" @Name "=" @Expression ("," @Name "=" @Expression)? #const }
		/ { "debugger"}
		/ { "import"}
		/ { "export"}
		/ { "function"}
		/ { "let"}
		/ { "throw"}
		/ { "try"}
		/ { "break" EOS #Break }
		/ { "with"}
		/ { "yield"}

CaseBlock
	= { "case" @ConstantExpression ":" @Statement #CaseBlock}

DefaultBlock
	= { "default" ":" @Statement #DefaultBlock}

LabelledStatement
	= { "label"}

//Literal
//==========
Literal
    [example:1]
    = '1'
>>>>>>> efd4a1c5a945e678725e8c495c43283070d2ea63
